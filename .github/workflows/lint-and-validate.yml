name: Lint & Validate
on:
  push:
  pull_request:

jobs:
  qa:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkoutv4

      - name: Set up Python
        uses: actions/setup-pythonv5
        with:
          python-version: '3.11'

      - name: Install dev tools (pinned)
        run: 
          python -m pip install --upgrade pip
          pip install -r requirements-dev.txt

      - name: Lint (Black & Flake8)
        run: 
          black --check .
          flake8 orchestrator

      - name: Setup Terraform
        uses: hashicorp/setup-terraformv3

      - name: Terraform init/fmt/validate
        run: 
          terraform -chdir=infra init -backend=false -input=false
          terraform -chdir=infra fmt -check
          terraform -chdir=infra validate
